---
import BaseLayout from '../layouts/BaseLayout.astro';
import SectionHeading from '../components/SectionHeading.astro';
import { siteConfig } from '../config/site';
import fs from 'node:fs';
import path from 'node:path';
import { fileURLToPath } from 'node:url';

const highlights = [
  { label: 'Güncel duyurular', href: '/duyurular' },
  { label: 'İletişim', href: '/iletisim' },
  { label: 'Alt birlikler', href: '/altbirlikler' }
];

const fallbackSlides = [
  { src: '/assets/hero/1.png', alt: 'Saha ziyareti' },
  { src: '/assets/hero/8.png', alt: 'Arı kovanları ve üretim alanı' },
  { src: '/assets/hero/10.png', alt: 'Kovan kontrolü' },
  { src: '/assets/hero/12.png', alt: 'Ekipman hazırlığı' },
  { src: '/assets/hero/14.png', alt: 'Toplantı ve bilgilendirme' },
  { src: '/assets/hero/16.png', alt: 'Üretici ziyaretleri' },
  { src: '/assets/hero/18.png', alt: 'Saha ölçüm çalışması' },
  { src: '/assets/hero/21.png', alt: 'Üreticilerle değerlendirme' },
  { src: '/assets/hero/23.png', alt: 'Depolama ve lojistik' },
  { src: '/assets/hero/28.png', alt: 'Arazi inceleme' }
];

const __dirname = path.dirname(fileURLToPath(import.meta.url));
const duyuruDir = path.resolve(__dirname, '../../public/assets/duyurular');
const announcementSlides = [
  {
    file: '0.jpeg',
    src: '/assets/duyurular/0.jpeg',
    href: '/duyurular/sanliurfa-genel-kurul-firat-cenberlitas/',
    title:
      'Şanlıurfa Bal Üreticiler Birliğinde gerçekleştirilen genel kurulda Fırat Çenberlitaş güven tazeleyerek görevine devam etti.',
    date: '2026',
    alt: 'Şanlıurfa Bal Üreticileri Birliği genel kurul'
  },
  {
    file: '1.jpeg',
    src: '/assets/duyurular/1.jpeg',
    href: '/duyurular/bitlis-valisi-ziyareti/',
    title:
      'Bitlis ve Hizan birlik başkanlarımızla birlikte gerçekleştirdiğimiz Bitlis Valimiz Sayın Ahmet Karakaya ziyareti.',
    date: '18 Şubat 2026',
    alt: 'Bitlis Valisi Ahmet Karakaya ziyareti'
  },
  {
    file: '2.jpg',
    src: '/assets/duyurular/2.jpg',
    href: '/duyurular/diyarbakir-birligi-taziye-ziyareti/',
    title:
      'Diyarbakır Bal Üreticileri Birliğimizi ziyaret ederek, önceki dönem başkanlarımızdan merhum Ali Rıza Demir’in oğullarına taziyelerimizi ilettik.',
    date: '2026',
    alt: 'Diyarbakır Birliği taziye ziyareti'
  },
  {
    file: '3.jpg',
    src: '/assets/duyurular/3.jpg',
    href: '/duyurular/sanliurfa-bassagligi-ziyareti/',
    title:
      'Yönetim kurulu olarak; Şanlıurfa Arıcılar Birliği Başkanımızın kıymetli annesinin vefatı dolayısıyla kendisini ziyaret ederek başsağlığı dileklerimizi ilettik.',
    date: '2026',
    alt: 'Şanlıurfa Birliği başsağlığı ziyareti'
  },
  {
    file: '4.jpg',
    src: '/assets/duyurular/4.jpg',
    href: '/duyurular/ankara-teskilatlanma-gorusmesi/',
    title:
      'Ankara’da Teşkilatlanma Daire Başkanı Sayın Ahmet Ünsal ile il bazlı yapılanma konusunda son derece olumlu görüşmeler gerçekleştirilmiştir. Bulundukları illerde ilçe bazlı kurulmuş birliklerimizden, mali genel kurullarını yapmadan önce il birliği statüsüne geçmeyi düşünenler varsa, çok ivedi bir şekilde Merkez Birliğimiz ile iletişime geçmeleri gerekmektedir. İl bazlı yapılanma sürecinde birkaç işlemin tamamlanmasının ardından il bazlı statüye geçiş mümkün olacaktır. Birliklerimizin daha güçlü ve kurumsal bir yapıya kavuşabilmesi adına, ilçe bazlı değil il bazlı teşkilatlanma büyük önem arz etmektedir.',
    date: '2026',
    alt: 'Ankara teşkilatlanma görüşmeleri'
  },
  {
    file: '5.jpg',
    src: '/assets/duyurular/5.jpg',
    href: '/duyurular/turk-patent-ziyareti/',
    title:
      'Türk Patent ve Marka Kurumu Başkanı Prof. Dr. Muhammed Zeki Durak’ı, Merkez Birliğimiz olarak makamında ziyaret ettik. Bal ve arı ürünlerimizin markalaşması ile coğrafi işaretler konularında verimli bir görüşme gerçekleştirdik.',
    date: '2026',
    alt: 'Türk Patent ve Marka Kurumu ziyareti'
  },
  {
    file: '7.jpeg',
    src: '/assets/duyurular/7.jpeg',
    href: '/duyurular/gaziantep-sertifika-toreni/',
    title:
      'Bal üreticileri birliklerimiz her geçen gün daha kurumsal bir yapıya kavuşuyor ve büyümeye devam ediyor. Gaziantep Bal Üreticileri Birliği Başkanımız Mehmet Uçar’ın öncülüğünde, bakanlık tarafından belgelendirilen eğitim programı kapsamında; Merkez Birliğimiz Yönetim Kurulu Başkan Yardımcımız Mehmet Ali Kutlu hocamızın eğitmen olarak yer aldığı proje doğrultusunda belgelendirme töreni gerçekleştirilmiş ve başarılı arıcılarımıza bakanlık onaylı ana arı sertifikaları takdim edilmiştir. Emeği geçen başta Gaziantep Birliğimiz olmak üzere, kıymetli hocamıza ve tüm paydaşlara teşekkür eder, sertifika alan arıcılarımızı tebrik ederiz',
    date: '2026',
    alt: 'Gaziantep Bal Üreticileri Birliği sertifika töreni'
  },
  {
    file: '8.jpeg',
    src: '/assets/duyurular/8.jpeg',
    href: '/duyurular/ari-yetistiricileri-birligi-hayirli-olsun/',
    title:
      'Türkiye Arı Yetiştiricileri Merkez Birliği Genel Başkanı Ali Demir ve kıymetli yönetim kurulu bugün Merkez Birliğimize hayırlı olsun ziyaretinde bulunmuştur.',
    date: '2026',
    alt: 'Türkiye Arı Yetiştiricileri Merkez Birliği hayırlı olsun ziyareti'
  }
];

let heroSlides = announcementSlides.filter((slide) => fs.existsSync(path.resolve(duyuruDir, slide.file)));

if (heroSlides.length === 0) {
  heroSlides = fallbackSlides.map((slide) => ({
    ...slide,
    href: '/duyurular',
    title: slide.alt,
    date: '2026',
    alt: slide.alt
  }));
}

const topAnnouncements = heroSlides.slice(0, 3);

const subUnions = [
  { title: 'İl birlikleri', note: 'Doğrulanmış iletişim bilgileri güncelleniyor.' },
  { title: 'Koordinasyon noktaları', note: 'Bölgesel temsil listesi hazırlanıyor.' },
  { title: 'İş birliği kanalları', note: 'Paydaş bildirimleri için tek merkez.' },
  { title: 'Eğitim ve bilgilendirme', note: 'Planlanan takvim paylaşılacak.' },
  { title: 'Standartlar', note: 'Kalite ve izlenebilirlik duyuruları.' },
  { title: 'Geri bildirim', note: 'Bilgi güncellemesi için İletişim sayfası.' }
];
---

<BaseLayout title="Ana Sayfa" description={siteConfig.description} canonical={siteConfig.url}>
  <section class="relative isolate overflow-hidden">
    <div aria-hidden="true" class="absolute inset-0 hero-bg pointer-events-none"></div>
    <div aria-hidden="true" class="absolute -left-10 -top-24 h-72 w-72 rounded-full bg-amber-200/45 blur-3xl pointer-events-none"></div>
    <div aria-hidden="true" class="absolute right-4 top-10 h-80 w-80 rounded-full bg-pine-200/40 blur-3xl pointer-events-none"></div>
    <div aria-hidden="true" class="absolute left-1/3 bottom-[-6rem] h-[18rem] w-[18rem] rounded-full bg-white/60 blur-[140px] pointer-events-none"></div>

    <div class="page-shell relative z-10 py-6 sm:py-12 lg:py-20">
      <div class="grid gap-10 lg:grid-cols-12 lg:items-center">
        <div class="space-y-6 lg:col-span-5">
          <span class="inline-flex items-center gap-2 rounded-full bg-amber-100/80 px-3 py-1 text-[11px] font-semibold uppercase tracking-[0.2em] text-pine-800">
            Resmî web sitesi
          </span>
          <h1 class="text-4xl leading-tight sm:text-5xl lg:text-[3.1rem] text-slate-900">
            Türkiye Bal Üreticileri Merkez Birliği
          </h1>
          <p class="text-lg text-slate-800">
            Arıcıların ortak sesi: üretici birlikleriyle koordinasyon, kalite ve izlenebilirlik için güncel duyurular ve
            şeffaf bilgilendirme.
          </p>
          <div class="flex flex-wrap gap-3 -translate-y-1">
            <a
              href="/duyurular"
              class="inline-flex items-center justify-center gap-2 rounded-full bg-pine-600 px-6 py-3 text-sm font-semibold text-white shadow-card transition hover:-translate-y-0.5 hover:bg-pine-700 focus-visible:shadow-focus"
              style="color: #fff;"
            >
              Duyurular
            </a>
            <a
              href="/hakkimizda"
              class="inline-flex items-center justify-center gap-2 rounded-full border border-sand-200 bg-white px-6 py-3 text-sm font-semibold text-slate-900 shadow-card transition hover:-translate-y-0.5 hover:border-pine-200 hover:text-pine-900 focus-visible:shadow-focus"
            >
              Hakkımızda
            </a>
          </div>
          <div class="flex flex-wrap gap-2 -translate-y-1.5">
            {highlights.map((item) => (
              <a
                class="inline-flex items-center gap-2 rounded-full border border-sand-200 bg-white/80 px-3 py-1.5 text-xs font-semibold text-slate-900 transition hover:-translate-y-0.5 hover:border-pine-200 hover:bg-white"
                href={item.href}
              >
                <span class="h-1.5 w-1.5 rounded-full bg-pine-500"></span>
                {item.label}
              </a>
            ))}
          </div>
        </div>

        <div class="lg:col-span-7">
          <div class="hero-rotator" data-hero-rotator>
            <div class="hero-card">
              <div class="hero-slider" data-hero-slider style={`--count:${heroSlides.length};`}>
                {heroSlides.map((slide, idx) => (
                  <figure
                    class={`hero-slide${idx === 0 ? ' is-active' : ''}`}
                    style={`--i:${idx}; --count:${heroSlides.length};`}
                  >
                    <a class="hero-link" href={slide.href} aria-label={slide.title}>
                      <div class="hero-media">
                        <img src={slide.src} alt={slide.alt} loading="lazy" decoding="async" />
                        <figcaption class="hero-caption">
                          <span class="hero-date">{slide.date}</span>
                          <span class="hero-title">
                            <span class="hero-title-text">{slide.title}</span>
                            <span class="hero-readmore">Devamını oku →</span>
                          </span>
                        </figcaption>
                      </div>
                    </a>
                  </figure>
                ))}
              </div>
            </div>
            <div class="hero-controls">
              <button class="hero-nav hero-nav-prev" type="button" aria-label="Önceki duyuru">‹</button>
              <div class="hero-dots">
                {heroSlides.map((_, idx) => (
                  <button class="hero-dot" type="button" aria-label={`Duyuru ${idx + 1}`} />
                ))}
              </div>
              <button class="hero-nav hero-nav-next" type="button" aria-label="Sonraki duyuru">›</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="page-shell section-gap summary-section">
    <div class="summary-pane">
      <div class="grid grid-cols-1 gap-8 lg:grid-cols-12 lg:items-start">
        <div class="space-y-5 lg:col-span-6">
          <div class="summary-heading">
            <SectionHeading
              eyebrow="Kurum özeti"
              title="Arıcıların ortak sesi"
              description="Merkez birlik, üretici birlikleriyle eşgüdümlü çalışarak kalite güvencesi, mevzuat takibi ve doğru bilgilendirmeyi sağlar."
            />
            <div class="heading-decor">
              <span class="bar"></span>
              <span class="dot"></span>
              <span class="bar short"></span>
            </div>
          </div>
        </div>
        <div class="grid grid-cols-1 gap-4 lg:col-span-6">
          <div class="summary-card flex items-start gap-3">
            <span class="mt-2 h-2.5 w-2.5 rounded-full bg-pine-500"></span>
            <div class="space-y-1">
              <p class="font-semibold text-slate-900">Üretici koordinasyonu</p>
              <p class="text-sm text-slate-700">İl birlikleriyle düzenli temas ve ortak karar iletişimi.</p>
            </div>
          </div>
          <div class="summary-card flex items-start gap-3">
            <span class="mt-2 h-2.5 w-2.5 rounded-full bg-pine-500"></span>
            <div class="space-y-1">
              <p class="font-semibold text-slate-900">Kalite ve izlenebilirlik</p>
              <p class="text-sm text-slate-700">Arı ürünlerinde standartların duyurulması ve takibi.</p>
            </div>
          </div>
          <div class="summary-card flex items-start gap-3">
            <span class="mt-2 h-2.5 w-2.5 rounded-full bg-pine-500"></span>
            <div class="space-y-1">
              <p class="font-semibold text-slate-900">Paydaş iletişimi</p>
              <p class="text-sm text-slate-700">Resmî duyuruların üreticilere hızlı ve açık aktarımı.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="page-shell section-gap">
    <div class="activities-pane space-y-6">
      <div class="flex flex-col gap-4 sm:flex-row sm:items-end sm:justify-between">
        <SectionHeading
          eyebrow="Duyurular"
          title="Öne çıkan duyurular"
          description="Genel kurul ziyaretlerinden ve saha temaslarından güncel duyurular."
        />
        <a
          href="/duyurular"
          class="inline-flex items-center justify-center gap-2 rounded-full border border-pine-600 bg-pine-600 px-4 py-2 text-sm font-semibold text-white shadow-card transition hover:-translate-y-0.5 hover:border-pine-700 hover:bg-pine-700 focus-visible:shadow-focus"
          style="color: #fff;"
        >
          Tüm duyurular
        </a>
      </div>

      {topAnnouncements.length > 0 ? (
        <div class="grid gap-6 md:grid-cols-2 xl:grid-cols-3" data-featured-grid>
          {topAnnouncements.map((item) => (
            <article class="group flex h-full flex-col overflow-hidden rounded-2xl border border-sand-200 bg-white shadow-card transition hover:-translate-y-1 hover:shadow-soft">
              <a class="block h-full" href={item.href}>
                <div class="relative aspect-[4/3] overflow-hidden bg-sand-100">
                  <img
                    src={item.src}
                    alt={item.title}
                    loading="lazy"
                    decoding="async"
                    class="h-full w-full object-cover transition duration-300 group-hover:scale-105"
                  />
                </div>
                <div class="flex flex-col gap-2 px-4 py-3 text-slate-900">
                  <p class="text-[11px] uppercase tracking-[0.18em] text-slate-500">{item.date}</p>
                  <h3 class="text-sm font-semibold">{item.title}</h3>
                  <p class="text-xs text-pine-700">Devamını oku →</p>
                </div>
              </a>
            </article>
          ))}
        </div>
      ) : (
        <div
          class="rounded-2xl border border-dashed border-sand-200 bg-sand-50 px-4 py-6 text-sm text-slate-700"
          data-featured-empty
        >
          Duyuru içerikleri hazırlanıyor.
        </div>
      )}
    </div>
  </section>

  <section class="page-shell section-gap">
    <div class="subunion-pane space-y-5">
      <div class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
        <SectionHeading
          eyebrow="Alt birlikler"
          title="Koordinasyon ağı"
          description="Doğrulanmış alt birlik bilgileri güncellenmektedir. Bilgi paylaşımı için bizimle iletişime geçebilirsiniz."
        />
        <a
          href="/iletisim"
          class="inline-flex items-center justify-center gap-2 rounded-full border border-sand-200 bg-white px-4 py-2 text-sm font-semibold text-pine-800 shadow-card transition hover:-translate-y-0.5 hover:border-pine-200 focus-visible:shadow-focus"
        >
          Bilgi ilet
        </a>
      </div>
      <ul class="grid gap-3 sm:grid-cols-2 lg:grid-cols-3">
        {subUnions.map((item) => (
          <li class="rounded-xl border border-sand-200 bg-white/92 px-4 py-3 shadow-card">
            <p class="font-semibold text-slate-900">{item.title}</p>
            <p class="text-xs text-slate-600">{item.note}</p>
          </li>
        ))}
      </ul>
    </div>
  </section>

  <section class="page-shell section-gap contact-section">
    <div class="contact-pane grid gap-5 lg:gap-6 lg:grid-cols-12 lg:items-start">
      <div class="space-y-3 lg:col-span-5 lg:self-start">
        <div class="inline-flex items-center gap-2 rounded-full bg-pine-100/70 px-3 py-1 text-[11px] font-semibold uppercase tracking-[0.18em] text-pine-800">
          İletişim
        </div>
        <h2 class="text-xl sm:text-2xl font-semibold text-slate-900 leading-snug">Doğrudan bize ulaşın</h2>
        <p class="text-sm sm:text-base text-slate-700">
          Sorularınız ve paylaşımlarınız için iletişime geçebilirsiniz. Telefon ve e-posta kanalları hızlı dönüş için açık.
        </p>

        <div class="space-y-2.5">
          <div class="contact-card">
            <div class="contact-label">Genel Sekreter</div>
            <div class="contact-value">Cansel Solak</div>
          </div>
          <a class="contact-card contact-link" href={`tel:${siteConfig.contacts.phone.replace(/\\s+/g, '')}`}>
            <div class="contact-label">Telefon</div>
            <div class="contact-value">{siteConfig.contacts.phone}</div>
          </a>
          <a class="contact-card contact-link" href={`mailto:${siteConfig.contacts.email || 'merbalbir@gmail.com'}`}>
            <div class="contact-label">E-posta</div>
            <div class="contact-value">{siteConfig.contacts.email || 'merbalbir@gmail.com'}</div>
          </a>
          <div class="contact-card">
            <div class="contact-label">Adres</div>
            <div class="contact-value">
              Ehlibeyt Mahallesi 1242. Cad. 2/22<br />
              Çankaya, Ankara
            </div>
          </div>
        </div>

        <div class="flex flex-wrap gap-3 pt-1">
          <a
            href="/iletisim"
            class="inline-flex items-center justify-center gap-2 rounded-full bg-pine-600 px-5 py-2.5 text-sm font-semibold text-white shadow-card transition hover:-translate-y-0.5 hover:bg-pine-700 focus-visible:shadow-focus"
            style="color:#fff;"
          >
            İletişim sayfası
          </a>
          <a
            href="https://www.google.com/maps/dir/?api=1&destination=Ehlibeyt%20Mahallesi%201242.%20Cad.%202%2F22%20%C3%87ankaya%20Ankara"
            class="inline-flex items-center justify-center gap-2 rounded-full border border-pine-200 bg-white px-5 py-2.5 text-sm font-semibold text-pine-800 shadow-card transition hover:-translate-y-0.5 hover:border-pine-300 focus-visible:shadow-focus"
          >
            Yol tarifi
          </a>
        </div>
      </div>

      <div class="lg:col-span-7 lg:mt-10 xl:mt-12">
        <div class="map-card">
          <div class="map-header">
            <span class="dot red"></span>
            <span class="dot amber"></span>
            <span class="dot green"></span>
            <span class="map-title">Ehlibeyt Mahallesi 1242. Cad. 2/22, Çankaya / Ankara</span>
          </div>
          <div class="map-embed">
            <iframe
              title="Ehlibeyt Mahallesi 1242. Cad. 2/22 Çankaya Ankara"
              loading="lazy"
              src="https://www.google.com/maps?q=Ehlibeyt%20Mahallesi%201242.%20Cad.%202/22%20%C3%87ankaya%20Ankara&output=embed"
              allowfullscreen
              referrerpolicy="no-referrer-when-downgrade"
            ></iframe>
          </div>
        </div>
      </div>
    </div>
  </section>

<!-- Slider artık saf CSS animasyonla dönüyor; JS kaldırıldı -->

</BaseLayout>

<style>
  .summary-section {
    position: relative;
    background:
      radial-gradient(120% 140% at 15% 20%, rgba(255, 207, 150, 0.35), transparent 55%),
      radial-gradient(120% 140% at 85% 10%, rgba(137, 199, 174, 0.35), transparent 55%),
      linear-gradient(185deg, #fefaf3 0%, #f5faf7 48%, #eef4ff 100%);
    width: 100%;
  }

  .summary-pane {
    position: relative;
    overflow: hidden;
    border-radius: 1.35rem;
    padding: clamp(22px, 4vw, 36px);
    width: 100%;
    background:
      radial-gradient(120% 120% at 20% 8%, rgba(142, 205, 174, 0.32) 0, transparent 42%),
      radial-gradient(110% 110% at 82% 10%, rgba(255, 214, 157, 0.28) 0, transparent 45%),
      linear-gradient(135deg, #f7fbf6 0%, #f3f7ff 55%, #eef4ff 100%);
    border: 1px solid rgba(13, 122, 76, 0.08);
    box-shadow: 0 20px 60px rgba(15, 43, 36, 0.12);
    isolation: isolate;
  }

  .summary-pane > * {
    position: relative;
    z-index: 1;
  }

  .summary-section .grid {
    width: 100%;
    justify-items: stretch;
  }

  .summary-pane::before,
  .summary-pane::after {
    content: '';
    position: absolute;
    inset: 0;
    pointer-events: none;
    opacity: 0.9;
    z-index: 0;
  }

  .summary-pane::before {
    background: radial-gradient(65% 65% at 15% 70%, rgba(12, 124, 78, 0.12), transparent 50%);
    filter: blur(0);
  }

  .summary-pane::after {
    background: radial-gradient(55% 55% at 85% 60%, rgba(9, 20, 40, 0.08), transparent 60%);
  }

  .summary-heading .heading-decor {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-top: 2.1rem;
    max-width: 640px;
    margin-left: 0;
  }

  .summary-heading .max-w-3xl p:last-child {
    margin-top: 0.65rem;
  }

  .heading-decor .bar {
    flex: 1 1 auto;
    height: 4px;
    border-radius: 999px;
    background: linear-gradient(90deg, #0c7c4e 0%, #63c27b 50%, #f5c453 100%);
    box-shadow: 0 8px 24px rgba(12, 124, 78, 0.18);
  }

  .heading-decor .bar.short {
    flex: 0.5 1 auto;
    background: linear-gradient(90deg, #0c7c4e 0%, #7fd19e 100%);
  }

  .heading-decor .dot {
    width: 12px;
    height: 12px;
    border-radius: 999px;
    background: #0d7a4c;
    box-shadow:
      0 0 0 6px rgba(13, 122, 76, 0.12),
      0 10px 24px rgba(13, 122, 76, 0.25);
  }

  .summary-card {
    border-radius: 1rem;
    border: 1px solid #e3eadf;
    background: rgba(255, 255, 255, 0.94);
    padding: 0.95rem 1.05rem;
    box-shadow: 0 12px 36px rgba(15, 49, 35, 0.08);
  }

  .activities-pane {
    position: relative;
    overflow: hidden;
    border-radius: 1.25rem;
    padding: clamp(18px, 3vw, 28px);
    background:
      radial-gradient(140% 140% at 18% 12%, rgba(248, 201, 145, 0.32), transparent 45%),
      radial-gradient(120% 120% at 82% 0%, rgba(125, 189, 160, 0.28), transparent 48%),
      linear-gradient(145deg, #fbf6ee 0%, #f4faf5 42%, #eef6ff 100%);
    border: 1px solid rgba(28, 91, 62, 0.08);
    box-shadow: 0 16px 48px rgba(12, 41, 60, 0.12);
  }

  .activities-pane::before {
    content: '';
    position: absolute;
    inset: 0;
    background:
      radial-gradient(85% 85% at 12% 65%, rgba(13, 122, 76, 0.08), transparent 55%),
      radial-gradient(65% 65% at 78% 65%, rgba(38, 88, 132, 0.08), transparent 58%);
    opacity: 0.9;
    pointer-events: none;
  }

  .activities-pane > * {
    position: relative;
    z-index: 1;
  }

  .subunion-pane {
    position: relative;
    overflow: hidden;
    border-radius: 1.15rem;
    padding: clamp(18px, 3vw, 26px);
    background:
      radial-gradient(115% 115% at 18% 12%, rgba(255, 212, 140, 0.16) 0, transparent 46%),
      radial-gradient(120% 120% at 82% 10%, rgba(123, 189, 160, 0.15) 0, transparent 48%),
      linear-gradient(135deg, #fdf8ef 0%, #f6fbf7 50%, #eef5ff 100%);
    border: 1px solid rgba(12, 124, 78, 0.05);
    box-shadow: 0 14px 42px rgba(17, 46, 52, 0.12);
  }

  .subunion-pane::before {
    content: '';
    position: absolute;
    inset: 0;
    background: radial-gradient(75% 75% at 85% 65%, rgba(12, 124, 78, 0.07), transparent 55%);
    pointer-events: none;
    opacity: 0.85;
  }

  .subunion-pane > * {
    position: relative;
    z-index: 1;
  }

  .contact-section {
    padding-bottom: 4rem;
  }

  .contact-pane {
    position: relative;
    overflow: hidden;
    border-radius: 1.25rem;
    padding: clamp(16px, 3vw, 28px);
    background:
      radial-gradient(130% 130% at 18% 5%, rgba(255, 212, 140, 0.18), transparent 45%),
      radial-gradient(120% 120% at 80% 15%, rgba(99, 184, 151, 0.18), transparent 48%),
      linear-gradient(140deg, #fdf8ef 0%, #f6fbf7 50%, #eef6ff 100%);
    border: 1px solid rgba(20, 92, 62, 0.08);
    box-shadow: 0 18px 52px rgba(15, 45, 54, 0.12);
  }

  .contact-pane::before {
    content: '';
    position: absolute;
    inset: 0;
    background:
      radial-gradient(80% 80% at 15% 70%, rgba(13, 122, 76, 0.08), transparent 55%),
      radial-gradient(70% 70% at 88% 60%, rgba(36, 74, 112, 0.08), transparent 58%);
    opacity: 0.85;
    pointer-events: none;
  }

  .contact-pane > * {
    position: relative;
    z-index: 1;
  }

  .contact-card {
    display: block;
    border: 1px solid rgba(12, 124, 78, 0.12);
    background: rgba(255, 255, 255, 0.92);
    border-radius: 0.9rem;
    padding: 0.65rem 0.85rem;
    box-shadow: 0 5px 14px rgba(12, 41, 60, 0.08);
    transition: transform 150ms ease, box-shadow 150ms ease;
  }

  .contact-link:hover {
    transform: translateY(-1px);
    box-shadow: 0 10px 26px rgba(12, 41, 60, 0.12);
    background: rgba(255, 255, 255, 0.98);
  }

  .contact-link {
    color: inherit;
    text-decoration: none;
  }

  .contact-label {
    font-size: 0.72rem;
    font-weight: 700;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    color: #0d7a4c;
    margin-bottom: 0.25rem;
  }

  .contact-value {
    font-size: 0.92rem;
    color: #0f172a;
    line-height: 1.35;
  }

  .map-card {
    width: 100%;
    max-width: 720px;
    display: block;
    margin: 0 auto;
    border-radius: 1rem;
    overflow: hidden;
    border: 1px solid rgba(12, 124, 78, 0.1);
    background: #0b1324;
    box-shadow: 0 12px 32px rgba(10, 25, 40, 0.2);
  }

  .map-header {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 0.55rem 0.85rem;
    background: linear-gradient(90deg, rgba(13, 122, 76, 0.18), rgba(11, 19, 36, 0.85));
    color: #e8f5ee;
    font-size: 0.82rem;
  }

  .map-header .dot {
    width: 10px;
    height: 10px;
    border-radius: 999px;
    display: inline-flex;
  }
  .map-header .dot.red {
    background: #f87171;
  }
  .map-header .dot.amber {
    background: #fbbf24;
  }
  .map-header .dot.green {
    background: #34d399;
  }
  .map-title {
    font-weight: 600;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .map-embed {
    position: relative;
    width: 100%;
    aspect-ratio: 3 / 2;
    background: #0b1324;
    min-height: 220px;
  }

  .map-embed iframe {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    border: 0;
  }

  @media (max-width: 768px) {
    .summary-pane {
      padding: 16px;
      border-radius: 1rem;
      margin: 0 auto;
      max-width: 100%;
    }
    .activities-pane {
      border-radius: 1rem;
      padding: 16px;
    }
    .subunion-pane {
      border-radius: 1rem;
      padding: 16px;
    }
    .contact-pane {
      border-radius: 1rem;
      padding: 16px;
    }

    .map-title {
      font-size: 0.78rem;
      max-width: 100%;
      white-space: normal;
      overflow: visible;
      text-overflow: unset;
    }

    .map-embed {
      aspect-ratio: 4 / 3;
      min-height: 200px;
    }

    .map-card {
      margin-top: 12px;
      max-width: 100%;
      width: 100%;
    }

    .map-header {
      flex-wrap: wrap;
      gap: 6px;
    }

    .summary-heading h2 {
      font-size: clamp(1.7rem, 6vw, 2rem);
      line-height: 1.15;
    }

    .summary-heading .max-w-3xl p {
      font-size: 0.95rem;
    }

    .summary-heading .heading-decor {
      margin-top: 1.2rem;
      max-width: 480px;
      width: 100%;
    }

    .summary-heading {
      max-width: 100%;
      width: 100%;
    }

    .summary-card {
      width: 100%;
    }

    .summary-card {
      padding: 0.85rem 0.95rem;
    }

    .hero-card,
    .hero-slider,
    .hero-media {
      width: 100%;
      max-width: 100%;
    }

    .hero-card {
      margin: 0 auto;
      max-width: 100%;
    }

    .hero-slider {
      padding: 0.6rem;
      border-radius: 1rem;
      max-width: 100%;
      aspect-ratio: auto;
      min-height: 0;
      height: clamp(240px, 72vw, 340px);
    }

    .hero-media {
      border-radius: 0.75rem;
    }

    .hero-caption {
      font-size: 0.82rem;
      padding: 0.6rem 0.8rem;
      margin-bottom: 0.25rem;
    }

  }

  @media (max-width: 480px) {
    .summary-pane {
      padding: 14px;
      margin: 0 auto;
    }

    .summary-heading .heading-decor {
      margin-top: 1rem;
    }

    .summary-heading .max-w-3xl p:last-child {
      margin-top: 0.4rem;
    }

    .hero-slider {
      height: clamp(220px, 75vw, 300px);
      padding: 0.5rem;
    }

    .hero-caption {
      font-size: 0.78rem;
      padding: 0.55rem 0.75rem;
    }

    .map-title {
      max-width: 100%;
      font-size: 0.76rem;
      text-align: left;
    }

    .contact-pane {
      padding: 14px;
    }
  }

  .hero-bg {
    background:
      radial-gradient(120% 120% at 15% 10%, rgba(255, 221, 157, 0.45) 0, transparent 40%),
      radial-gradient(120% 120% at 80% 0%, rgba(139, 188, 160, 0.4) 0, transparent 42%),
      linear-gradient(135deg, #fdf6e3 0%, #f3f7f4 45%, #e8f1ff 100%);
  }

  .hero-card {
    position: relative;
    overflow: visible;
    border-radius: 1.2rem;
    border: none;
    background: transparent;
    box-shadow: 0 30px 90px rgba(10, 18, 30, 0.22);
    padding: 0;
  }

  .hero-slider {
    position: relative;
    width: 100%;
    height: clamp(430px, 50vw, 640px);
    border-radius: 1.15rem;
    overflow: hidden;
    background: radial-gradient(140% 140% at 15% 15%, rgba(255, 255, 255, 0.16), transparent 55%),
      radial-gradient(140% 140% at 85% 0%, rgba(255, 255, 255, 0.12), transparent 50%),
      #0a1424;
    isolation: isolate;
    padding: 0.6rem;
  }

  @supports (aspect-ratio: 16 / 9) {
    .hero-slider {
      aspect-ratio: 16 / 9;
      height: auto;
      min-height: 430px;
    }
  }

  /* Mobile override: keep slider inside viewport and avoid horizontal overflow */
  @media (max-width: 768px) {
    .hero-slider {
      aspect-ratio: auto !important;
      height: clamp(240px, 72vw, 340px);
      min-height: 0;
    }
  }

  @media (max-width: 480px) {
    .hero-slider {
      height: clamp(220px, 75vw, 300px);
    }
  }

  .hero-slide {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    transform: translateY(6px);
    transition: opacity 260ms ease, transform 260ms ease;
    overflow: hidden;
    background: #0f1724;
    pointer-events: none;
    cursor: pointer;
  }
  .hero-slide.is-active {
    opacity: 1;
    transform: translateY(0);
    pointer-events: auto;
  }
  .hero-link {
    display: block;
    width: 100%;
    height: 100%;
    color: inherit;
    text-decoration: none;
  }

  .hero-media {
    position: relative;
    width: 100%;
    height: 100%;
    background: #0a1424;
    border-radius: 0.9rem;
    overflow: hidden;
  }

  .hero-media img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
    display: block;
  }

  .hero-caption {
    position: absolute;
    inset-inline: 0;
    bottom: 0;
    display: grid;
    gap: 0.35rem;
    padding: 0.75rem 1rem 0.9rem;
    background: linear-gradient(180deg, rgba(15, 23, 42, 0) 0%, rgba(15, 23, 42, 0.82) 100%);
    color: white;
    font-size: 0.9rem;
    line-height: 1.3;
    border-top: 1px solid rgba(255, 255, 255, 0.18);
  }
  .hero-date {
    font-size: 0.72rem;
    letter-spacing: 0.14em;
    text-transform: uppercase;
    opacity: 0.85;
  }
  .hero-title {
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 700;
    min-width: 0;
  }
  .hero-title-text {
    min-width: 0;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
  .hero-readmore {
    white-space: nowrap;
    font-weight: 600;
    opacity: 0.9;
  }
  .hero-controls {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    margin-top: 14px;
  }
  .hero-nav {
    width: 34px;
    height: 34px;
    border-radius: 999px;
    border: 1px solid rgba(15, 23, 42, 0.2);
    background: rgba(255, 255, 255, 0.92);
    color: #0f172a;
    display: grid;
    place-items: center;
    font-size: 1.1rem;
    transition: transform 140ms ease, box-shadow 140ms ease;
  }
  .hero-nav:hover {
    transform: translateY(-1px);
    box-shadow: 0 10px 20px rgba(15, 23, 42, 0.16);
  }
  .hero-dots {
    display: flex;
    gap: 6px;
    padding: 0 4px;
  }
  .hero-dot {
    width: 8px;
    height: 8px;
    border-radius: 999px;
    border: none;
    background: rgba(148, 163, 184, 0.7);
    cursor: pointer;
  }
  .hero-dot.is-active {
    background: #0d7a4c;
  }
  .hero-controls.is-hidden {
    display: none;
  }

  @media (max-width: 768px) {
    .hero-media {
      border-radius: 0.75rem;
    }

    .hero-caption {
      font-size: 0.82rem;
      padding: 0.6rem 0.8rem;
      margin-bottom: 0.25rem;
    }

  }

  @media (max-width: 480px) {
    .hero-caption {
      font-size: 0.78rem;
      padding: 0.55rem 0.75rem;
    }
  }

  
</style>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAl_TPmEOlbliY3CDig7p-VGbSEVoFxl2c",
    authDomain: "merkez-birligi.firebaseapp.com",
    projectId: "merkez-birligi",
    storageBucket: "merkez-birligi.firebasestorage.app",
    messagingSenderId: "1017642940775",
    appId: "1:1017642940775:web:7c7ace1b2cba16a6fdd7c2",
    measurementId: "G-LT1MWENXB7"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const formatDate = (value) => {
    if (!value) return "2026";
    if (typeof value === "string") {
      const parsed = new Date(value);
      if (Number.isNaN(parsed.getTime())) return value;
      return new Intl.DateTimeFormat("tr-TR", { day: "2-digit", month: "long", year: "numeric" }).format(parsed);
    }
    const date = value instanceof Date ? value : value.toDate?.() || new Date(value);
    if (Number.isNaN(date.getTime())) return "2026";
    return new Intl.DateTimeFormat("tr-TR", { day: "2-digit", month: "long", year: "numeric" }).format(date);
  };

  const initHeroSlider = () => {
    const root = document.querySelector('[data-hero-rotator]');
    if (!root) return;
    const slider = root.querySelector('[data-hero-slider]');
    if (!slider) return;
    const slides = Array.from(slider.querySelectorAll('.hero-slide'));
    const dots = Array.from(root.querySelectorAll('.hero-dot'));
    const controls = root.querySelector('.hero-controls');
    const prev = controls?.querySelector('.hero-nav-prev');
    const next = controls?.querySelector('.hero-nav-next');
    const intervalMs = 5000;
    let active = 0;
    let timer;

    if (slides.length === 0) return;

    const setActive = (idx) => {
      active = (idx + slides.length) % slides.length;
      slides.forEach((slide, i) => slide.classList.toggle('is-active', i === active));
      dots.forEach((dot, i) => dot.classList.toggle('is-active', i === active));
    };

    const start = () => {
      timer = window.setInterval(() => setActive(active + 1), intervalMs);
    };

    const restart = () => {
      clearInterval(timer);
      start();
    };

    prev?.addEventListener('click', () => {
      setActive(active - 1);
      restart();
    });

    next?.addEventListener('click', () => {
      setActive(active + 1);
      restart();
    });

    dots.forEach((dot, i) =>
      dot.addEventListener('click', () => {
        setActive(i);
        restart();
      })
    );

    setActive(0);
    if (slides.length > 1) {
      start();
    } else {
      controls?.classList.add('is-hidden');
    }
  };

  const renderHero = (items) => {
    const root = document.querySelector('[data-hero-rotator]');
    if (!root) return;
    const slider = root.querySelector('[data-hero-slider]');
    const dotsWrap = root.querySelector('.hero-dots');
    if (!slider || !dotsWrap) return;

    slider.style.setProperty('--count', items.length);
    slider.innerHTML = items
      .map((item, idx) => {
        const href = `/duyurular/detay?id=${item.id}`;
        return `
          <figure class="hero-slide${idx === 0 ? ' is-active' : ''}" style="--i:${idx}; --count:${items.length};">
            <a class="hero-link" href="${href}" aria-label="${item.title}">
              <div class="hero-media">
                <img src="${item.coverUrl}" alt="${item.title}" loading="lazy" decoding="async" />
                <figcaption class="hero-caption">
                  <span class="hero-date">${item.dateLabel}</span>
                  <span class="hero-title">
                    <span class="hero-title-text">${item.title}</span>
                    <span class="hero-readmore">Devamını oku →</span>
                  </span>
                </figcaption>
              </div>
            </a>
          </figure>
        `;
      })
      .join('');

    dotsWrap.innerHTML = items
      .map((_, idx) => `<button class="hero-dot" type="button" aria-label="Duyuru ${idx + 1}"></button>`)
      .join('');
  };

  const renderFeatured = (items) => {
    const grid = document.querySelector('[data-featured-grid]');
    const empty = document.querySelector('[data-featured-empty]');
    if (!grid) return;
    if (!items.length) return;
    grid.innerHTML = items
      .map((item) => {
        const href = `/duyurular/detay?id=${item.id}`;
        return `
          <article class="group flex h-full flex-col overflow-hidden rounded-2xl border border-sand-200 bg-white shadow-card transition hover:-translate-y-1 hover:shadow-soft">
            <a class="block h-full" href="${href}">
              <div class="relative aspect-[4/3] overflow-hidden bg-sand-100">
                <img src="${item.coverUrl}" alt="${item.title}" loading="lazy" decoding="async" class="h-full w-full object-cover transition duration-300 group-hover:scale-105" />
              </div>
              <div class="flex flex-col gap-2 px-4 py-3 text-slate-900">
                <p class="text-[11px] uppercase tracking-[0.18em] text-slate-500">${item.dateLabel}</p>
                <h3 class="text-sm font-semibold">${item.title}</h3>
                <p class="text-xs text-pine-700">Devamını oku →</p>
              </div>
            </a>
          </article>
        `;
      })
      .join('');

    if (empty) empty.classList.add('hidden');
  };

  const loadAnnouncements = async () => {
    try {
      const snapshot = await getDocs(collection(db, "announcements"));
      const items = snapshot.docs
        .map((doc) => {
          const data = doc.data() || {};
          const coverUrl = data.coverUrl || data.images?.[0]?.url;
          if (!data.title || !coverUrl || !data.publishedAt) return null;
          const dateLabel = formatDate(data.eventDate || data.publishedAt || data.createdAt);
          return {
            id: doc.id,
            title: data.title,
            coverUrl,
            dateLabel,
            order: typeof data.order === "number" ? data.order : null,
            publishedAt: data.publishedAt || data.createdAt
          };
        })
        .filter(Boolean);

      if (items.length > 0) {
        const sorted = [...items].sort((a, b) => {
          const orderA = a.order ?? 9999;
          const orderB = b.order ?? 9999;
          if (orderA !== orderB) return orderA - orderB;
          const timeA = a.publishedAt?.seconds || 0;
          const timeB = b.publishedAt?.seconds || 0;
          return timeB - timeA;
        });
        renderHero(sorted);
        renderFeatured(sorted.slice(0, 3));
      }
    } catch (error) {
      // fallback to static content
    }

    initHeroSlider();
  };

  if (document.readyState === 'loading') {
    window.addEventListener('DOMContentLoaded', loadAnnouncements);
  } else {
    loadAnnouncements();
  }
</script>
