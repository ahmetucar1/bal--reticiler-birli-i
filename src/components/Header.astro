---
import { siteConfig, type NavItem } from '../config/site';

const { currentPath = '/' } = Astro.props;
const navItems: NavItem[] = siteConfig.nav;

const isActive = (href: string) => {
  if (href === '/') return currentPath === '/';
  return currentPath.startsWith(href);
};

const isHome = false;

const headerClass = 'sticky top-0 z-50 border-b border-sand-200 bg-sand-50/90 backdrop-blur';
---

<header class={`${headerClass} transition-colors duration-200`}>
  <div class="mx-auto flex h-16 max-w-6xl items-center gap-4 px-4 sm:px-6 lg:px-8">
    <a class="flex items-center gap-3 text-slate-900 overflow-hidden" href="/" aria-label={siteConfig.name}>
      <picture class="shrink-0">
        <source srcset="/assets/brand/logo-400.png" media="(min-width: 768px)" />
        <img
          src="/assets/brand/logo-180.png"
          alt={`${siteConfig.brandName} logosu`}
          class="h-8 w-auto max-h-8 sm:h-9 sm:max-h-9 lg:h-10 lg:max-h-10"
          style="object-fit: contain;"
          loading="eager"
          decoding="async"
        />
      </picture>
      <span class="text-xs font-semibold sm:hidden truncate max-w-[180px] whitespace-nowrap">
        Bal Üreticileri Merkez Birliği
      </span>
      <span class="text-sm font-semibold hidden sm:inline lg:hidden truncate max-w-[200px]">
        Bal Üreticileri Merkez Birliği
      </span>
      <span class="text-base font-semibold hidden lg:inline whitespace-nowrap">
        {siteConfig.brandName}
      </span>
    </a>

    <nav class="hidden ml-auto items-center gap-1 md:flex whitespace-nowrap">
      {navItems.map((item) => (
        <a
          href={item.href}
          class={`shrink-0 rounded-full px-2.5 lg:px-3 xl:px-3.5 py-2 text-[12.5px] md:text-[13px] lg:text-sm xl:text-base font-medium transition-colors duration-150 ${
            isActive(item.href)
              ? 'bg-pine-100 text-pine-800'
              : 'text-slate-800 hover:bg-sand-100'
          }`}
          aria-current={isActive(item.href) ? 'page' : undefined}
        >
          {item.title}
        </a>
      ))}
    </nav>

    <div class="ml-auto md:hidden">
      <button
        id="menu-toggle"
        class="flex h-10 w-10 items-center justify-center rounded-full border border-sand-200 bg-white text-slate-900 shadow-card transition active:scale-95"
      >
        <span class="sr-only">Menüyü aç</span>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.7" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>
      <div
        id="menu-panel"
        class="hidden absolute left-0 right-0 mt-2 bg-white text-slate-900 border-t border-sand-200 shadow-soft"
      >
        <nav class="flex flex-col gap-1 px-4 py-3 text-base">
          {navItems.map((item) => (
            <a
              href={item.href}
              class={`rounded-lg px-3 py-2 ${isActive(item.href) ? 'bg-pine-100 text-pine-800' : 'text-slate-800 hover:bg-sand-100'}`}
              aria-current={isActive(item.href) ? 'page' : undefined}
            >
              {item.title}
            </a>
          ))}
        </nav>
      </div>
    </div>
  </div>

  <script type="module">
    const btn = document.getElementById('menu-toggle');
    const panel = document.getElementById('menu-panel');
    btn?.addEventListener('click', () => {
      panel?.classList.toggle('hidden');
    });
    document.addEventListener('click', (e) => {
      if (!panel || !btn) return;
      if (btn.contains(e.target) || panel.contains(e.target)) return;
      panel.classList.add('hidden');
    });
  </script>
</header>
